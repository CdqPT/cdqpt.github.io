---
title: 树莓派开机教程
date: 2019-04-16 15:59:00
categories: 教程
tags: 嵌入式
toc: true
img: /medias/paperimg/mcu.jpg
summary: 包括树莓派的烧录，无线连接，远程桌面，以及备份等。
author: 陈德强
top: 
password: 
cover: 
---

**硬件准备：**
树莓派一块；
网线一根；
闪迪32G/64G microSDHC UHS-I存储卡一块；
川宇多合一读卡器一块。
硬件决定了读写速度，如果不懂硬件就按推荐的买吧。

# 一、下载镜像
官网下载基于Debian系统的Raspbian Stretch with desktop and recommended software镜像文件。[下载地址](https://www.raspberrypi.org/downloads/raspbian/)
# 二、烧录镜像
这是一款镜像烧录软件。[下载地址](https://sourceforge.net/projects/win32diskimager/files/latest/download)

选择SD卡
选择镜像
write烧录

红灯常亮： 未能检测到TF卡；
双灯常亮： 未能检测到系统；
红灯常亮，黄灯闪烁： 系统运行正常。
# 三、有网线获取树莓派ip地址

使用SSH投屏方式。
Raspbian默认用户名：pi；默认密码：raspberry
智元素默认用户名：pi；默认密码：123456
## 3.1 新建ssh文件
在SD卡根目录新建ssh文件,不需要有内容。
## 3.2 硬件连接
使用网线连接笔记本网口，电源由手机usb线提供。
## 3.3 获取树莓派ip地址
下载局域网ip获取软件[advanced ip scanner](http://www.advanced-ip-scanner.com/)
点击扫描可获取树莓派的ip地址。
或者！
使用手机软件更方便，下载一个LanScan的app接入局域网就可以扫描局域网内的Wi-Fi了

# 四、无网线获取树莓派ip地址

把之前安装系统的SD卡取下来再插到电脑上打开，在根目录放置一个文件名为wpa_supplicant.conf的文件，内容如下：
```
country=CN
ctrl_interface=/var/run/wpa_supplicant
update_config=1
network={
    ssid="robot908"
    psk="robotrobot"
    priority=1
}
network={
       ssid="cdq"
       psk="110103083"
       priority=2
}
network={
       ssid="一行白鹭上青天"
       psk="110103083"
       priority=3
}
network={
       ssid="Tenda_0D8B90"
       psk="12345678"
       priority=4
}
```
这样就可以开机自动连接wifi了，然后通过advanced ip scanner软件扫描局域网下的ip地址。

# 五、远程桌面
远程桌面有vnc和ssh两种方式。这里使用ssh+vnc。

## 5.1 win环境下安装putty
putty软件仅能调用命令窗口，对小白不太友好，但是可以利用ip直接进入界面。
![putty](https://ws4.sinaimg.cn/large/006jQClrly1g25fz6qmkej30mx0eh3z8.jpg)
下载ssh远程工具[putty](https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html)
填写树莓派ip地址，点击open
点击 是
输入用户名和密码
这种方式只有终端，没有画面，下面利用vnc viewer调取树莓派画面。

## 5.2 MAC环境下直接ssh
mac环境下直接ssh即可调用终端，例如：`ssh pi@192.168.0.123`
如果出现如下警告：
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@    WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!     @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
IT IS POSSIBLE THAT SOMEONE IS DOING SOMETHING NASTY!
Someone could be eavesdropping on you right now (man-in-the-middle attack)!
It is also possible that a host key has just been changed.
The fingerprint for the ECDSA key sent by the remote host is
SHA256:w9vtgxNn4O5eyFJ0ypx6dt3SZIjg+8Cid5+HLoU7r6s.
Please contact your system administrator.
Add correct host key in /Users/cdq/.ssh/known_hosts to get rid of this message.
Offending ECDSA key in /Users/cdq/.ssh/known_hosts:3
ECDSA host key for 192.168.0.123 has changed and you have requested strict checking.
Host key verification failed.


可以输入如下指令解决，ip替换为树莓派的ip：
```
ssh-keygen -R 192.168.0.123
```

# 六、安装远程桌面工具

## 6.1 安装nomachine
vnc卡的吃屎，还不能传输文件，因此下一步使用nomachine建立远程桌面。
使用putty打开终端后，准备下载nomachine，
首先查看自己树莓派的版本，
```
uname -a
```
Linux raspberrypi 4.14.98-v7+ #1200 SMP Tue Feb 12 20:27:48 GMT 2019 armv7l GNU/Linux
查看到是armv7架构，
用笔记本查看最新版软件包地址：[https://www.nomachine.com/download/linux&id=29&s=Raspberry](https://www.nomachine.com/download/linux&id=29&s=Raspberry)
比如：我的是pi 3,ARMV7 DEB,所以版本是6.6.8_5
千万不要下错了，不然安装不了。使用下面命令下载安装包，注意换成自己的版本。
```
wget https://download.nomachine.com/download/6.6/Raspberry/nomachine_6.6.8_5_armhf.deb
```
```
sudo dpkg -i nomachine_6.6.8_5_armhf.deb
```
设置root密码
```
sudo passwd root
```
输入两遍密码
获取root权限
```
su root
```
启动nomachine
```
/usr/NX/bin/nxserver --status
```
NX> 111 New connections to NoMachine server are enabled.
NX> 162 Enabled service: nxserver.
NX> 162 Enabled service: nxnode.
NX> 162 Enabled service: nxd.

这样nomachine就启动了，且是开机自启状态。
然后到官网下载Windows或者MAC的nomachine，输入树莓派的ip地址就可以连接了！



## 6.2 使用vnc(保留备用，无需操作)
**在树莓派上安装vnc**
使用ssh调取树莓派终端后，安装vnc viewer
```
sudo apt-get install tightvncserver
```
第一次启用vnc viewer
```
tightvncserver
```
这时提示需要配置密码，8个字符，超出8个自动截取前8位。例如密码设置为：12345678。注意输入密码时不显示字符。
然后会让你确认verify，在输入一遍12345678
y
再启用一次vnc viewer
```
tightvncserver
```
显示：
New 'X' desktop is raspberrypi:2
说明启用了vnc，并且端口是2
[vnc](http://wx1.sinaimg.cn/large/006jQClrly1g2o7tzpg0oj30mx0eh3zm.jpg)

**在mac上安装vnc viwer**
根据版本下载需要的上位机，我这里是苹果mac版本。[下载地址](https://www.realvnc.com/en/connect/download/viewer/)
下载后输入树莓派的ip地址和端口号即可，例如：
```
192.168.0.123:3
```
![屏幕快照 2019-05-03 下午4.47.56](https://ws2.sinaimg.cn/large/006jQClrly1g2o8595w5pj31dw0y2tbq.jpg)
双击图标，即可看到熟悉的画面：
![屏幕快照 2019-05-03 下午4.50.20](https://wx3.sinaimg.cn/large/006jQClrly1g2o879hw8fj31kq17i1l0.jpg)


# 七，设置屏幕分辨率
参考：[树莓派设置分辨率](https://purethought.cn/2019/05/02/%E7%BC%96%E7%A8%8B/Ubuntu/%E6%A0%91%E8%8E%93%E6%B4%BE%E8%AE%BE%E7%BD%AE%E5%88%86%E8%BE%A8%E7%8E%87/)

# 七、系统备份

## 7.1 新建镜像文件
找个地方新建镜像文件，如mypi.img,不需要有内容。
## 7.2 备份镜像
使用win32DiskImager软件
选择mypi.img镜像文件
选择SD卡
read 读取
## 7.3 系统恢复
系统恢复和系统烧录步骤一样。


参考链接：
https://blog.csdn.net/a407496490/article/details/80636012
https://blog.csdn.net/yzy_1996/article/details/82916940
https://www.cnblogs.com/playboysnow/p/4987103.html
